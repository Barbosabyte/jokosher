#!/usr/bin/env python

import os, sys

try:
	import JokosherApp, Globals
except:
	print "Cannot find local file JokosherApp.py."
	os.environ["JOKOSHER_DATA_PATH"] = "/usr/share/jokosher/"
	try:
		import Jokosher.JokosherApp as JokosherApp
		import Jokosher.Globals as Globals
	except:
		print "Cannot find global Jokosher."
		sys.exit()

import locale, gettext, optparse
_ = gettext.gettext

try:
	locale.setlocale(locale.LC_ALL, '')
	gettext.bindtextdomain(Globals.LOCALE_APP, Globals.LOCALE_PATH)
	gettext.bind_textdomain_codeset(Globals.LOCALE_APP, "UTF-8");
	gettext.textdomain(Globals.LOCALE_APP)
except locale.Error:
	print "Locale unsupported, defaulting to english for all Jokosher specific text"
	
# parse command line
openproject = None
loadExtensions = True

parser = optparse.OptionParser(usage="%prog [options] [project-file]", version="0.2-SVN")
#command line options
parser.add_option("-d", "--debug", action="store_true", dest="debug", 
				help=_("Print debug output to stdout"))
parser.add_option("-g", "--gst-debug", action="store_true", dest="gstDebug", 
				help=_("Sent debug output to Gstreamer's debug system"))
parser.add_option("-s", "--safe-mode", action="store_true", dest="safeMode", 
				help=_("Don't load extensions or last project on startup (same as -ne)"))
parser.add_option("-w", "--welcome-dialog", action="store_true", dest="forceWelcome", 
				help=_("Force the welcome dialog to show on startup"))
parser.add_option("-n", "--no-project", action="store_true", dest="forceNoProject", 
				help=_("Force Jokosher to load without a welcome dialog or project"))
parser.add_option("-e", "--no-extensions", action="store_true", dest="noextensions", 
				help=_("Do not load extensions on startup"))

(options, args) = parser.parse_args()
if len(args) > 0:
	openproject = args[0]
	
Globals.DEBUG_STDOUT = options.debug
Globals.DEBUG_GST = options.gstDebug

if options.forceWelcome:
	startupType = 2
elif options.forceNoProject:
	startupType = 1
else:
	startupType = None

if options.safeMode:
	loadExtensions = False
	startupType = 1

if options.noextensions:
	loadExtensions = False


#Launching the program
#JokosherApp.MainApp(openproject, options.safeMode, options.forceWelcome)
JokosherApp.MainApp(openproject, loadExtensions, startupType)
JokosherApp.gtk.threads_init()
JokosherApp.gtk.main()
